version: "3.9"

services:
  sgnl-api:
    build: .
    container_name: sgnl-api-dev
    restart: "always"
    ports:
      - "${PORT:-8000}:${PORT:-8000}"
    environment:
      - PYTHONUNBUFFERED=1
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - TAVILY_API_KEY=${TAVILY_API_KEY}
      - N8N_WEBHOOK_URL=${N8N_WEBHOOK_URL}
      - N8N_FAST_SEARCH_URL=${N8N_FAST_SEARCH_URL}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:3000}
      - RATE_LIMIT=${RATE_LIMIT:-100}
      - RATE_WINDOW_SECONDS=${RATE_WINDOW_SECONDS:-60}
      - HOST=${HOST:-0.0.0.0}
      - PORT=${PORT:-8000}
      - LOG_LEVEL=DEBUG
      - DENSITY_THRESHOLD=${DENSITY_THRESHOLD:-0.45}
      - LLM_MAX_CHARS=${LLM_MAX_CHARS:-12000}
      # nginx-proxy configuration
      - VIRTUAL_HOST=${VIRTUAL_HOST:-your-domain.com}
      - VIRTUAL_PORT=${PORT:-8000}
      - LETSENCRYPT_HOST=${LETSENCRYPT_HOST:-your-domain.com}
      - LETSENCRYPT_EMAIL=${LETSENCRYPT_EMAIL:-admin@your-domain.com}
    networks:
      - sgnl-net
      - nginx-proxy_default

networks:
  sgnl-net:
    driver: bridge
  nginx-proxy_default:
    external: true
